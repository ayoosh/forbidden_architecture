
#define STACK_ADDR_LOW 0XFFFF ;
#define STACK_ADDR_HIGH 0X03FF ;

#define SPART_ADDR_HIGH 0X0800 ;
#define BAUD_HIGH_BYTE 0X00AA ;
#define BAUD_LOW_BYTE 0X00AA ;

#define SPART_READ_MASK 2 ;
#define SPART_WRITE_MASK 1 ;

# Set Stack Pointer ;
LLW R1 STACK_ADDR_LOW ;
LHW R1 STACK_ADDR_HIGH ;

# Set SPART BaudRate ;
AND R2 R0 R0 ;
AND R3 R0 R0 ;
LHW R2 SPART_ADDR_HIGH ;
LLW R3 BAUD_LOW_BYTE ;
STORE R3 R2 2 ;
LLW R3 BAUD_HIGH_BYTE ;
STORE R3 R2 3 ;
AND R5 R0 R0 ;
AND R6 R0 R0 ;
LLW R5 SPART_WRITE_MASK ;
LLW R6 SPART_READ_MASK ;
AND R7 R0 R0 ;

# Poll on SPART status register ;
SPART_WRITE_STATUS_POLL LOAD R4 0 ;
AND R4 R4 R5 ;
BEQ SPART_WRITE_STATUS_POLL ;

